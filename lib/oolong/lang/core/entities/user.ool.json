{
  "type": {
    "userStatus": {
      "type": "enum",
      "values": {
        "type": "Array",
        "value": [
          "inactive",
          "active",
          "disabled",
          "forbidden",
          "deleted"
        ]
      }
    }
  },
  "entity": {
    "user": {
      "features": [
        "autoId",
        "createTimestamp",
        "updateTimestamp",
        "logicalDeletion",
        {
          "type": "FunctionCall",
          "name": "atLeastOneNotNull",
          "arguments": {
            "type": "Array",
            "value": [
              {
                "type": "Variable",
                "name": "email"
              },
              {
                "type": "Variable",
                "name": "mobile"
              }
            ]
          }
        },
        "validateAllFieldsOnCreation"
      ],
      "fields": {
        "email": {
          "type": "email"
        },
        "mobile": {
          "type": "mobile"
        },
        "password": {
          "type": "password",
          "modifiers": [
            {
              "type": "FunctionCall",
              "name": "hashPassword",
              "arguments": {
                "type": "Array",
                "value": [
                  {
                    "type": "ObjectReference",
                    "name": "new.passwordSalt"
                  }
                ]
              }
            }
          ]
        },
        "passwordSalt": {
          "type": "text",
          "fixedLength": 32,
          "generator": true,
          "readOnly": true
        },
        "displayName": {
          "type": "name",
          "optional": true
        },
        "emailVerified": {
          "type": "flag",
          "default": false
        },
        "mobileVerified": {
          "type": "flag",
          "default": false
        },
        "status": {
          "type": "userStatus",
          "default": "inactive"
        },
        "tag": {
          "type": "tag",
          "optional": true
        }
      },
      "indexes": [
        {
          "fields": [
            "email"
          ],
          "unique": true
        },
        {
          "fields": [
            "mobile"
          ],
          "unique": true
        }
      ],
      "interface": {
        "checkUserCredential": {
          "accept": [
            {
              "type": "Variable",
              "name": "identity"
            },
            {
              "type": "Variable",
              "name": "password",
              "modifiers": [
                {
                  "type": "FunctionCall",
                  "name": "hashPassword",
                  "arguments": {
                    "type": "Array",
                    "value": [
                      {
                        "type": "ObjectReference",
                        "name": "user.passwordSalt"
                      }
                    ]
                  }
                }
              ]
            }
          ],
          "implementation": [
            {
              "type": "populate",
              "output": "user",
              "projection": [
                "user.*"
              ],
              "filter": {
                "left": {
                  "type": "BinaryExpression",
                  "operator": "=",
                  "left": {
                    "type": "Variable",
                    "name": "email"
                  },
                  "right": {
                    "type": "ObjectReference",
                    "name": "identity"
                  }
                },
                "type": "BinaryExpression",
                "operator": "or",
                "right": {
                  "type": "BinaryExpression",
                  "operator": "=",
                  "left": {
                    "type": "Variable",
                    "name": "mobile"
                  },
                  "right": {
                    "type": "ObjectReference",
                    "name": "identity"
                  }
                }
              }
            }
          ],
          "return": {
            "value": {
              "type": "Object",
              "value": {
                "data": {
                  "type": "Variable",
                  "name": "user"
                }
              }
            },
            "exceptions": [
              {
                "type": "ConditionalStatement",
                "test": {
                  "type": "UnaryExpression",
                  "operator": "not-exists",
                  "argument": {
                    "type": "ObjectReference",
                    "name": "user"
                  }
                },
                "then": {
                  "type": "Object",
                  "value": {
                    "error": "user not found"
                  }
                }
              },
              {
                "type": "ConditionalStatement",
                "test": {
                  "type": "BinaryExpression",
                  "operator": "!=",
                  "left": {
                    "type": "ObjectReference",
                    "name": "password"
                  },
                  "right": {
                    "type": "ObjectReference",
                    "name": "user.password"
                  }
                },
                "then": {
                  "type": "Object",
                  "value": {
                    "error": "invalid password"
                  }
                }
              }
            ]
          }
        }
      }
    }
  },
  "id": "user",
  "namespace": [
    "/Users/RockieGuo/Documents/GIT/mowa/lib/oolong/lang/core/entities/oolong",
    "/Users/RockieGuo/Documents/GIT/mowa/lib/oolong/lang/core/entities",
    "/Users/RockieGuo/Documents/GIT/mowa/lib/oolong/lang/core/entities/user"
  ],
  "name": "user",
  "path": "/Users/RockieGuo/Documents/GIT/mowa/lib/oolong/lang/core/entities"
}